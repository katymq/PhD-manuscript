\documentclass[a4paper,twoside,openanay,11pt]{book}
% la classe book est naturellement en deux faces 
% ou \documentclass[twoside]{report}
% avec twoside pour que inner soit à gauche sur les page impaires et à droite sur les pages paires (voir ci-dessous)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% chargement des packages 
% \usepackage[T1]{fontenc}
\usepackage{booktabs} %some rules toprule midrule etc
% \usepackage{mwe} %for chapt4 2 figures side by side
\usepackage{natbib}
\bibliographystyle{apa-good}
\usepackage{graphicx}
\usepackage{makecell} %cells in appendix
\graphicspath{{Figures/}}
\usepackage{etoc} %contents in each chapter
\usepackage{blindtext} 
% \usepackage[linktocpage]{hyperref} %hyperlinks table of contents on numbers
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \hypersetup{hidelinks}

% Hyperref with backref option
\usepackage[colorlinks=true,pagebackref=true,linktocpage,citecolor=blue]{hyperref}


\hypersetup{
  colorlinks   = true, %Colours links instead of ugly boxes
  urlcolor     = blue, %Colour for external hyperlinks
  linkcolor    = magenta, %Colour of internal links
  citecolor   = blue, %Colour of citations
  backref=true,  % Enable back-references
  pagebackref=true,  % Enable page number back-references
  hyperindex=true,  % Enable hyperlinks in index
}
\usepackage{geometry}
% ce package permet de régler très simplement les marges, la zone de texte effective, ...
% si on n'utilise pas ce package, il faut régler les marges avec les commandes de base mais cela est compliqué.

%
% Les dimensions de la page pour l'offset sont 175 x 245 mm. 
% Pour une impression sans réduction sur de l'A4 et avec un rognage à droite et en bas,
% l'offset demande une marge intérieure >= 15 mm et une marge supérieure >= 10 mm. 
%
% Remarque : la marge intérieure est à gauche sur les pages impaires et à droite sur les pages paires en double face,
%  elle toujours à gauche en simple face
% 
% Avec le package geometry, on règle la marge intérieure par inner, la marge supérieure par top et la zone utile par total. 
% Les autres dimensions sont automatiquement calculées en fonction du format du papier (A4 par défaut).  
% La clef includeheadfoot entraîne que les entêtes et pieds de page sont inclus dans la zone utile. 
% Sinon, il régler body qui fixe la zone de texte et tenir compte des dimensions des entêtes et pieds de page qui sont alors situés à l'extérieur de body.
% Voir la documentation de geometry pour plus d'info. 
%      

%\geometry{reset,inner=25mm,top=15mm,total={130mm,215mm},includeheadfoot,showframe} %version offset
\geometry{reset,centering,total={130mm,210mm},includeheadfoot}
\setlength{\headheight}{14pt}

% Ici, on a réglé la zone utile à 130 x 215 mm ce qui laisse 45 mm pour les marges intérieures et extérieures et 30 mm pour les marges en haut et en bas.
% Pour tenir compte de la reliure, j'ai mis 25 mm en intérieur, ce qui donnera 20 mm en extérieur après rognage droite. (mais on peut changer, c'est une question de goût)
% Pour le vertical, j'ai centré mes 215 mm dans les 245 mm soit une marge supérieure de 15 mm, ce qui donnera une marge inférieure de 15 mm après rognage en bas
%
% Remarque 1 : la zone utile peut aussi être élargie, la seule contrainte est de laisser les marges droite et inférieure suffisantes,
% étant entendu que les marges intérieure et supérieures sont au minimum 15 et 10 mm.  Pour rappel, on ne règle pas les marges extérieure 
% et inférieure car elles se calculent à patir des marges intérieure et supérieure et de total.     
% 
% TODO: Remarque 2 : la clef showframe permet de voir des lignes représentant les différentes dimensions. Utile dans la phase de mise au point.
% Ne pas oublier de supprimer cette clef dans la version finale.

% TODO: Remarque 3 : pour un résultat optimal, il faut convertir le ps en pdf (ou compiler en pdflatex)
% et demander à l'offset d'imprimer le pdf sans mise à l'échelle



\usepackage{todonotes}
\usepackage{etoolbox}
\usepackage{multirow}
\usepackage{diagbox}
\usepackage{hyperref}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{xcolor}
% \usepackage{fontspec}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{tcolorbox}
\usepackage{bigfoot}
\usepackage{epigraph}
\usepackage[shortlabels]{enumitem}
\usepackage{hhline}
\usepackage{listings}
\usepackage{color}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{array}
\usepackage{eurosym}
\usepackage{gensymb}
\usepackage{amsthm}
\usepackage[toc,page]{appendix}
\usepackage{pdfpages}
\usepackage{float}
\usepackage{amssymb}
\usepackage[makeroom]{cancel}

%------------------------------------
%------------------------------------
% Trying to improve the quality of the pdf
% \usepackage[libertine,cmintegrals,cmbraces,vvarbb]{newtxmath}
\usepackage[scaled=0.98]{zi4}
\usepackage{lmodern}
\usepackage[english]{babel}
%------------------------------------
%------------------------------------


%--------------------
% Unsupervised segmentation
\usepackage[export]{adjustbox}
\usepackage{tikz}
\usepackage{pgfplots}
\pgfplotsset{compat=1.17}
\usetikzlibrary{shapes, positioning, matrix, calc, pgfplots.statistics,
pgfplots.groupplots, pgfplots.colorbrewer, 3d, arrows, positioning, quotes,
backgrounds, arrows.meta, spy, fit, }

\newcommand{\tikzst}[2][line width=1pt,cyan,opacity=0.4]{%
  \tikz[baseline]{ \node[anchor=text,outer sep=0pt,inner sep=0pt, text=black] (A) {#2}; \draw[#1] ([xshift=-0.1ex]A.west) --  ([xshift=0.1ex]A.east);}%
}%because st from soul does not like Xref`'
\usepackage{subcaption}

\usepackage{array}
\newcolumntype{Z}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
%--------------------


% \usepackage{bm}
% % \usepackage{bbm}
% \usepackage{soul}

% --------------Algorithm
% \usepackage{algorithm}% http://ctan.org/pkg/algorithms
% \usepackage{algpseudocode}
% \usepackage{algorithm}
% \usepackage[noend]{algpseudocode}
\usepackage{algorithm}
\usepackage{algpseudocode}
%\usepackage[english, ruled,
%commentsnumbered,onelanguage]{algorithm2e}
% \usepackage[english, lined, boxed, linesnumbered,
% commentsnumbered,onelanguage]{algorithm2e}
% \SetKwInput{KwData}{Input}
% \algdef{SE}[DOWHILE]{Do}{doWhile}{\algorithmicdo}[1]{\algorithmicwhile\ #1}%
\algrenewcommand\algorithmicrequire{\textbf{Input:}}
\algrenewcommand\algorithmicensure{\textbf{Output:}}
% remove line number for specific lines with \nonl
\let\oldnl\nl% Store \nl in \oldnl
\newcommand{\nonl}{\renewcommand{\nl}{\let\nl\oldnl}}% Remove line number for one line
% -----------------


\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\setlength{\epigraphwidth}{0.51\textwidth}

\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]
\newtheorem{example}{Example}[section]
\newtheorem{remark}{Remark}[section]
\newtheorem{remarks}{Remark}
\newtheorem{proposition}{Proposition}[section]
\newtheorem{theorem}{Theorem}[section]
\newtheorem{usecaseinner}{Use Case}
\newtheorem{lemma}{Lemma}[section]
\newtheorem{model}{Model}

\newtheorem{corollary}{Corollary}
% \newtheorem{proof}{Proof}
\newtheorem{scenario}{Scenario}

\newcommand{\katy}[1]{\todo[inline,color=blue]{#1 --- Katy TO-DO}}
\newcommand{\yohan}[1]{\todo[inline,color=yellow]{#1 --- Yohan Obs}}
\newcommand{\yohanobs}[1]{\todo[size=\tiny,color=orange]{#1  \hfill --- Yohan}}
\newcommand{\katyobs}[1]{\todo[size=\tiny,color=green]{#1  \hfill --- Katy}}
\newcommand{\nocontentsline}[3]{}
\newcommand{\tocless}[2]{\bgroup\let\addcontentsline=\nocontentsline#1{#2}\egroup}

\newenvironment{usecase}[1]{%
	\renewcommand\theusecaseinner{#1}%
	\usecaseinner
}{\endusecaseinner}
%\lstset{basicstyle=\linespread{0.4}}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
	aboveskip=3mm,
	belowskip=3mm,
	showstringspaces=false,
	columns=flexible,
	basicstyle={\linespread{1}\small\ttfamily},
	numbers=none,
	numberstyle=\tiny\color{gray},
	keywordstyle=\color{blue},
	commentstyle=\color{dkgreen},
	stringstyle=\color{mauve},
	breaklines=true,
	breakatwhitespace=true,
	tabsize=3
}

\newtoggle{hidecomments} %==false by default
%\toggletrue{hidecomments} %uncomment this line to hide comments

\iftoggle{hidecomments}{ % ignores comments but still defines the corresponding commands to prevent compiling errors
	\newcommand{\reviewer}[1]{}
}{
	\newcommand{\reviewer}[1]{\todo[color=white!40, inline]{\footnotesize{Reviewer: #1}}}
}

\newcommand{\Csharp}{%
	{\settoheight{\dimen0}{C}C\kern-.05em \resizebox{!}{\dimen0}{\raisebox{\depth}{\#}}}}
%------------------------------------------------------------------
% CREATE ACRONYMS
%------------------------------------------------------------------
% \usepackage[acronym]{glossaries}
\usepackage[acronym,nonumberlist]{glossaries}

%todo: see below for acronyms/glossaries
%if glossary as well and not only acronyms, see: https://tex.stackexchange.com/questions/8946/how-to-combine-acronym-and-glossary
%to generate the list of acronyms:
%makeindex -s filename.ist -t filename.alg -o filename.acr filename.acn
%->
%makeindex -s latex_avec_réduction_pour_impression_recto_verso_et_rognage_minimum.ist -t latex_avec_réduction_pour_impression_recto_verso_et_rognage_minimum.alg -o latex_avec_réduction_pour_impression_recto_verso_et_rognage_minimum.acr latex_avec_réduction_pour_impression_recto_verso_et_rognage_minimum.acn

\makeglossaries
% \setglossarypreamble[acronym]{Various acronyms will be used throughout this dissertation to abbreviate frequent terms, some of which will even find usages across all sections. The expansion will be given at least on the first occurrence of each acronym in the text, but the following list of acronyms can be used as a reference if needed.}
%------------------------------------------------------------------
%------------------------------------------------------------------
% CREATE NOTATIONS
%------------------------------------------------------------------
\usepackage{nomencl}
\makenomenclature
% \renewcommand{\nomname}{List of Notations}


% \setnomenclaturepreamble{Various notations will be used throughout 
% this dissertation to abbreviate frequent terms, some of which will 
% even find usages across all sections. The expansion will be given 
% at least on the first occurrence of each notation in the text,
%  but the following list of notations can be used as a reference 
% if needed.}
%------------------------------------------------------------------
%------------------------------------------------------------------
\usepackage{titlesec}
\usepackage{titletoc}
\usepackage{fancyhdr}

% Define the page style for the front matter


\titleformat{\chapter}[display]
{\bfseries\huge}
{\filleft\Large\MakeUppercase{\chaptertitlename} \  \rlap{ \resizebox{!}{0.8cm}{\thechapter} \rule{5cm}{1.2cm}}}
{0ex}
{%\titlerule
	\vspace{2ex}%
	\filleft}
[\vspace{2ex}%
%\startcontents%
%\printcontents{l}{1}{\setcounter{tocdepth}{1}}%
\titlerule%\setcounter{tocdepth}{2}%
]

\titleformat{\section}
{\bfseries\Large}
{\thesection.}
{0.5em}
{}
[\vspace{0.5ex}
\titlerule]

\fancypagestyle{frontmatter}{
    \fancyhf{} % Clear header and footer
    \fancyhead[R]{\leftmark} % Set the chapter title in the upper-right corner
    \renewcommand{\headrulewidth}{0.4pt} % Add a horizontal rule under the header
}
% \includeonly{chapter4}

%-------------------------------------------------------------------------
%-------------------------------------------------------------------------
\begin{document}
\input{globaldefinitions.tex} % Include global definitions

\includepdf[]{1ere.pdf}
\thispagestyle{empty}
\cleardoublepage
\frontmatter
% \cleardoublepage

% \pagestyle{front}
\thispagestyle{empty}
\include{acknowledgments.tex}
\thispagestyle{empty}
\tableofcontents
\thispagestyle{empty}
% \input{notations.tex}
% \printnomenclature
% \thispagestyle{empty}
% \input{acronyms.tex}
% \thispagestyle{empty}


% \chapter*{List of Notations}
\addcontentsline{toc}{chapter}{Nomenclature}
\input{notations.tex}

% \chapter*{List of Acronyms}
\addcontentsline{toc}{chapter}{Acronyms}
\input{acronyms.tex}

%------------------------------------
%NCLUDED CHAPTERS:
\mainmatter
\include{abstract_french}
\thispagestyle{empty}
\include{abstract}
\thispagestyle{empty}
\include{ch1}
\thispagestyle{empty}

\include{ch2}
\thispagestyle{empty}

\include{ch3}
\thispagestyle{empty}

\include{ch4}
\thispagestyle{empty}

\include{ch5}
\thispagestyle{empty}

\include{conclusion}
\thispagestyle{empty}


\begin{appendices}
\input{appendix}
\input{appendix22}
\input{appendix2}
\input{appendix3}
\input{appendix4}
\input{appendix5}
\end{appendices}

%BACK MATTER:
\backmatter
\listoffigures
\listoftables

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% bibliography
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \bibliographystyle{apa-good}% the mandatory bibstyle
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\addcontentsline{toc}{chapter}{Bibliography}
\bibliography{sources}

\clearpage
% \input{backcover.tex}
\includepdf[]{4eme.pdf}
\thispagestyle{empty}
\end{document}
